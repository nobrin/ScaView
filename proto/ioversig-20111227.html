<!DOCTYPE html>
<html>
<head>
  <title>I over Sigma(I)</title>
  <script type="text/javascript">
	window.addEventListener("load", function() {
		var hkl2resolution = function(cell, miller_index) {
			// Calculating resolution of indexed reflection.
			var sin = Math.sin, cos = Math.cos, pow = Math.pow;
			var A = cell[3] / 180.0 * Math.PI,
				B = cell[4] / 180.0 * Math.PI,
				G = cell[5] / 180.0 * Math.PI,
				a = cell[0] * 1, b = cell[1] * 1, c = cell[2] * 1,
				h = miller_index[0] * 1, k = miller_index[1] * 1, l = miller_index[2] * 1;
			var v1 = (pow(h, 2) / pow(a, 2)) * pow(sin(A), 2)
					+ (pow(k, 2) / pow(b, 2)) * pow(sin(B), 2)
					+ (pow(l, 2) / pow(c, 2)) * pow(sin(G), 2),
				v2 = ((2 * k * l) / (b * c)) * (cos(B) * cos(G) - cos(A)),
				v3 = ((2 * h * l) / (a * c)) * (cos(G) * cos(A) - cos(B)),
				v4 = ((2 * h * k) / (a * b)) * (cos(A) * cos(B) - cos(G)),
				v0 = 1 - pow(cos(A), 2) - pow(cos(B), 2) - pow(cos(G), 2) + 2 * cos(A) * cos(B) * cos(G),
				v = (v1 + v2 + v3 + v4) / v0,
				d = Math.sqrt(1 / v);
			return d;
		};

		// Reflection object
		function Reflection() {};
		Reflection.fromScaLine = function(line, cell) {
			var obj = new Reflection();
			obj._items = line.trim().split(/\s+/);
			obj._resolution = hkl2resolution(cell, obj.hkl);
			return obj;
		};
		Object.defineProperties(Reflection.prototype, {
			hkl			: { get: function() { return this._items.slice(0, 3); } },
			intensity	: { get: function() { return this._items[3] * 1; } },
			sigma		: { get: function() { return this._items[4] * 1; } },
			iOverSigma	: { get: function() { return this.intensity / this.sigma; } },
			resolution	: { get: function() { return this._resolution; } }
		});

		// Scalepack file object
		function ScaFile(lines) {
			var refl,
				cell = lines[2].trim().split(/\s+/).slice(0, 6);
			this.reflections = [];
			this.intensity = this.sigma = this.iOverSigma = 0;
			for(var i=3;i<lines.length;i++){
				refl = Reflection.fromScaLine(lines[i], cell);
				this.intensity += refl.intensity;
				this.sigma += refl.sigma;
				this.iOverSigma += refl.iOverSigma;
				this.reflections.push(refl);
			}
			this.reflections.sort(function(a, b) { return a.resolution - b.resolution; });
		}
		ScaFile.prototype.getAverageIntensity = function() { return this.intensity / this.reflections.length; };
		ScaFile.prototype.getAverageSigma = function() { return this.sigma / this.reflections.length; };
		ScaFile.prototype.getAverageIoverSigma = function() { return this.iOverSigma / this.reflections.length; };
		ScaFile.prototype.splitToShellsByCount = function(count) {
			// split to shells by reflection count
			var cnt = count,
				rs = new ResolutionShells(),
				shell = new ShellRange()
			for(var i=0;i<this.reflections.length;i++){
				shell.reflections.push(this.reflections[i]);
				cnt--;
				if(cnt === 0){
					rs.shells.push(shell);
					cnt = count;
					shell = new ShellRange();
				}
			}
			if(shell.reflections.length){ rs.shells.push(shell); }
			return rs;
		};
		ScaFile.prototype.splitToShellsByShells = function(shells) {
			var count = Math.ceil(this.reflections.length / shells);
			return this.splitToShellsByCount(count);
		};

		// Shell object
		function ShellRange() {
			this.reflections = [];
			this.fromLog = { redundancy:-1, count:-1 };
		}
		ShellRange.prototype.getLowerLimit = function() { return this.reflections[this.reflections.length - 1].resolution; };
		ShellRange.prototype.getUpperLimit = function() { return this.reflections[0].resolution; };
		ShellRange.prototype.getResolution = function() {
			return (this.getLowerLimit() + this.getUpperLimit()) / 2;
		};
		ShellRange.prototype.getAverageIntensity = function() {
			var intensity = 0;
			for(var i=0;i<this.reflections.length;i++){ intensity += this.reflections[i].intensity; }
			return intensity / this.reflections.length;
		};
		ShellRange.prototype.getAverageSigma = function() {
			var sigma = 0;
			for(var i=0;i<this.reflections.length;i++){ sigma += this.reflections[i].sigma; }
			return sigma / this.reflections.length;
		};
		ShellRange.prototype.getIoverSigma = function() {
			var ios = 0;
			for(var i=0;i<this.reflections.length;i++){ ios += this.reflections[i].iOverSigma; }
			return ios / this.reflections.length;
		};
		ShellRange.prototype.toCSV = function(digits) {
			var cols = [];
			digits = (digits === undefined ? 3 : digits);
			cols.push(this.getLowerLimit().toFixed(2));
			cols.push(this.getUpperLimit().toFixed(2));
			cols.push(this.getAverageIntensity().toFixed(digits));
			cols.push(this.getAverageSigma().toFixed(digits));
			cols.push((this.getAverageIntensity() / this.getAverageSigma()).toFixed(digits));
			cols.push(this.getIoverSigma().toFixed(digits));
			cols.push(this.reflections.length);
			return cols.join(",");
		};

		// Parsers
		// for counting reflections
		function ObservationsBlockParser() { this.shells = [], this.total = -1; }
		ObservationsBlockParser.headLine = "  Lower Upper      No. of reflections with given No. of observations";
		ObservationsBlockParser.prototype.addLine = function(line) {
			if(line.indexOf(ObservationsBlockParser.headLine) === 0){ return true; }
			if(line.indexOf("  limit limit     0     1     2     3     4") === 0){ return true; }
			if(line.indexOf(" All hkl") === 0){
				this.total = line.trim().split(/\s+/)[12] * 1;
				return false;
			}
			this.shells.push(line.trim().split(/\s+/)[12] * 1);
			return true;
		};

		// for get redundancies
		function RedundancyBlockParser() { this.shells = [], this.total = -1; }
		RedundancyBlockParser.headLine = "     Shell       Average Redundancy Per Shell";
		RedundancyBlockParser.prototype.addLine = function(line) {
			if(line.indexOf(RedundancyBlockParser.headLine) === 0){ return true; }
			if(line.indexOf("  Lower Upper") === 0 || line.indexOf("  limit limit") === 0){ return true; }
			if(line.indexOf("  All hkl") === 0){
				this.total = line.trim().split(/\s+/)[2] * 1;
				return false;
			}
			this.shells.push(line.trim().split(/\s+/)[2] * 1);
			return true;
		};

		// for completeness
		function CompletenessBlockParser() { this.shells = [], this.total = -1; }
		CompletenessBlockParser.headLine = "  Lower Upper      % of of reflections with I / Sigma less than";
		CompletenessBlockParser.prototype.addLine = function(line) {
			if(line.indexOf(CompletenessBlockParser.headLine) === 0){ return true; }
			if(line.indexOf("  limit limit") === 0){ return true; }
			if(line.indexOf(" All hkl") === 0){
				this.total = line.trim().split(/\s+/)[10] * 1;
				return false;
			}
			this.shells.push(line.trim().split(/\s+/)[10] * 1);
			return true;
		};

		// for summary
		function SummaryBlockParser() { this.shells = [], this.total = []; }
		SummaryBlockParser.headLine = " Shell Lower Upper Average      Average     Norm. Linear Square";
		SummaryBlockParser.prototype.addLine = function(line) {
			if(line.indexOf(SummaryBlockParser.headLine) === 0){ return true; }
			if(line.indexOf(" limit    Angstrom       I   error   stat. Chi**2  R-fac  R-fac") === 0){ return true; }
			if(line.indexOf("  All reflections") === 0){ this.total = line.trim().split(/\s+/); return false; }
			this.shells.push(line.trim().split(/\s+/));
			return true;
		};

		// for total observations
		function TotalObservationsParser() { this.all = this.over1 = -1; }
		TotalObservationsParser.headLine = " All films";
		TotalObservationsParser.prototype.addLine = function(line) {
			var items = line.trim().split(/\s+/);
			this.all = items[2] * 1;
			this.over1 = items[3] * 1;
			return false;
		};

		// Shell results from SCALEPACK log
		function LogShellRange(cnt, redun, comp, summary) {
			this.count = cnt;
			this.redundancy = redun;
			this.completeness = comp;
			this.lowerLimit = summary[0], this.upperLimit = summary[1];
			this.intensity = summary[2], this.sigma = summary[3], this.chi2 = summary[5];
			this.rmerge = summary[6], this.rSq = summary[7];
		}

		// Shells
		function ResolutionShells() {
			this.totalFromLog = null;
			this.shells = [];
		}
		ResolutionShells.fromScalepack = function(logLines, sca) {
			var chk = 0, parser = null, res = {},
				shellCounts, shellRedun, shellSummary, shellComp,
				parsers = [
					ObservationsBlockParser, RedundancyBlockParser, CompletenessBlockParser,
					SummaryBlockParser, TotalObservationsParser
				];

			for(var i=0;i<logLines.length;i++){
				if(parser){
					if(!parser.addLine(logLines[i])){ res[parser.constructor] = parser; parser = null; }
				}else{
					for(var j=0;j<parsers.length;j++){
						if(logLines[i].indexOf(parsers[j].headLine) === 0){
							parser = new parsers[j]();
							if(!parser.addLine(logLines[i])){ res[parser.constructor] = parser; parser = null; }
							break;
						}
					}
				}
			}

			shellRedun = res[RedundancyBlockParser].shells.slice().reverse();
			shellCounts = res[ObservationsBlockParser].shells.slice().reverse();
			shellSummary = res[SummaryBlockParser].shells.slice().reverse();
			shellComp = res[CompletenessBlockParser].shells.slice().reverse();
			var cnt = shellCounts.shift(),
				redun = shellRedun.shift(),
				summary = shellSummary.shift(),
				comp = shellComp.shift(),
				sr = new ShellRange(),
				shells = [];
			sr.fromLog = new LogShellRange(cnt, redun, comp, summary);
			shells.push(sr);
			for(var n=0;n<sca.reflections.length;n++){
				shells[shells.length - 1].reflections.push(sca.reflections[n]);
				cnt--;
				if(cnt === 0 && shellCounts.length){
					sr = new ShellRange();
					cnt = shellCounts.shift();
					sr.fromLog = new LogShellRange(cnt, shellRedun.shift(), shellComp.shift(), shellSummary.shift());
					shells.push(sr);
				}
			}
			var obj = new ResolutionShells();
			obj.shells = shells;
			obj.totalFromLog = new LogShellRange(
				res[ObservationsBlockParser].total, res[RedundancyBlockParser].total,
				res[CompletenessBlockParser].total, res[SummaryBlockParser].total
			);
			obj.allObservations = res[TotalObservationsParser].all;
			obj.observationsOver1 = res[TotalObservationsParser].over1;
			return obj;
		};

		// MyTableDcorator
		function MyTableDecorator(tbl) { this.tbl = tbl; }
		MyTableDecorator.prototype.clear = function() {
			while(this.tbl.tBodies[0].childNodes.length){ this.tbl.tBodies[0].removeChild(this.tbl.tBodies[0].childNodes[0]); }
			while(this.tbl.tFoot.childNodes.length){ this.tbl.tFoot.removeChild(this.tbl.tFoot.childNodes[0]); }
		};

		// ResultTableDecorator
		function ResultTableDecorator(tbl) { this.tbl = tbl; }
		ResultTableDecorator.prototype = new MyTableDecorator();
		ResultTableDecorator.prototype.addShell = function(shell) {
			var tr = document.createElement("tr");
			for(var i=0;i<7;i++){ tr.appendChild(document.createElement("td")); }
			tr.childNodes[0].textContent = shell.getLowerLimit().toFixed(2);
			tr.childNodes[1].textContent = shell.getUpperLimit().toFixed(2);
			tr.childNodes[2].textContent = shell.getAverageIntensity().toFixed(1);
			tr.childNodes[3].textContent = shell.getAverageSigma().toFixed(1);
			tr.childNodes[4].textContent = (shell.getAverageIntensity() / shell.getAverageSigma()).toFixed(1);
			tr.childNodes[5].textContent = shell.getIoverSigma().toFixed(1);
			tr.childNodes[6].textContent = shell.reflections.length;
			this.tbl.tBodies[0].appendChild(tr);
		};
		ResultTableDecorator.prototype.addTotal = function(sca) {
			var tr = document.createElement("tr");
			for(var i=0;i<7;i++){ tr.appendChild(document.createElement("td")); }
			tr.childNodes[0].textContent = "All";
			tr.childNodes[2].textContent = sca.getAverageIntensity().toFixed(1);
			tr.childNodes[3].textContent = sca.getAverageSigma().toFixed(1);
			tr.childNodes[4].textContent = (sca.getAverageIntensity() / sca.getAverageSigma()).toFixed(1);
			tr.childNodes[5].textContent = sca.getAverageIoverSigma().toFixed(1);
			tr.childNodes[6].textContent = sca.reflections.length;
			this.tbl.tFoot.appendChild(tr);
		};

		// LogTableDecorator
		function LogTableDecorator(tbl) { this.tbl = tbl; }
		LogTableDecorator.prototype = new MyTableDecorator();
		LogTableDecorator.prototype.addShell = function(shell, calcShell) {
			var tr = document.createElement("tr");
			for(var i=0;i<13;i++){ tr.appendChild(document.createElement("td")); }
			tr.childNodes[0].textContent = shell.lowerLimit;
			tr.childNodes[1].textContent = shell.upperLimit;
			tr.childNodes[2].textContent = shell.intensity;
			tr.childNodes[4].textContent = shell.sigma;
			tr.childNodes[6].textContent = (shell.intensity / shell.sigma).toFixed(1);
			tr.childNodes[8].textContent = shell.redundancy.toFixed(1);
			tr.childNodes[9].textContent = shell.rmerge;
			tr.childNodes[10].textContent = shell.rSq;
			tr.childNodes[11].textContent = shell.completeness.toFixed(1);
			tr.childNodes[12].textContent = shell.count;

			// Calculating difference with calculated results
			var intensity = shell.intensity * 1 - calcShell.getAverageIntensity();
			if(Math.abs(intensity) < 0.05){ intensity = 0; }
			var sigma = shell.sigma * 1 - calcShell.getAverageSigma();
			if(Math.abs(sigma) < 0.05){ sigma = 0; }
			var ios = (shell.intensity / shell.sigma) - (calcShell.getAverageIntensity() / calcShell.getAverageSigma());
			if(Math.abs(ios) < 0.05){ ios = 0; }
			tr.childNodes[3].textContent = intensity === 0 ? "" : intensity.toFixed(1);
			tr.childNodes[5].textContent = sigma === 0 ? "" : sigma.toFixed(1);
			tr.childNodes[7].textContent = ios === 0 ? "" : ios.toFixed(1);
			this.tbl.tBodies[0].appendChild(tr);
		};
		LogTableDecorator.prototype.addTotal = function(shell, sca) {
			var tr = document.createElement("tr");
			for(var i=0;i<13;i++){ tr.appendChild(document.createElement("td")); }
			tr.childNodes[0].textContent = "All";
			tr.childNodes[2].textContent = shell.intensity;
			tr.childNodes[4].textContent = shell.sigma;
			tr.childNodes[6].textContent = (shell.intensity / shell.sigma).toFixed(1);
			tr.childNodes[8].textContent = shell.redundancy.toFixed(1);
			tr.childNodes[9].textContent = shell.rmerge;
			tr.childNodes[10].textContent = shell.rSq;
			tr.childNodes[11].textContent = shell.completeness.toFixed(1);
			tr.childNodes[12].textContent = shell.count;

			// Calculating difference with calculated results
			var intensity = shell.intensity * 1 - sca.getAverageIntensity();
			if(Math.abs(intensity) < 0.05){ intensity = 0; }
			var sigma = shell.sigma * 1 - sca.getAverageSigma();
			if(Math.abs(sigma) < 0.05){ sigma = 0; }
			var ios = (shell.intensity / shell.sigma) - (sca.getAverageIntensity() / sca.getAverageSigma());
			if(Math.abs(ios) < 0.05){ ios = 0; }
			tr.childNodes[3].textContent = intensity === 0 ? "" : intensity.toFixed(1);
			tr.childNodes[5].textContent = sigma === 0 ? "" : sigma.toFixed(1);
			tr.childNodes[7].textContent = ios === 0 ? "" : ios.toFixed(1);
			this.tbl.tFoot.appendChild(tr);
		};

		var drawWilsonPlot = function() {
			// Wilson-plot-like calculation
			// X: (1 / 2d)^2
			// Y: ln(<I>)
			if(!oShells || !oSca){ alert("Calculate, first!!"); return; }
			var rs = oSca.splitToShellsByShells(200);
			var intensity;
			var getX = function(shell) { return 1 / Math.pow(2 * shell.getResolution(), 2); };

			var minX = getX(rs.shells[rs.shells.length-1]);
			var maxX = getX(rs.shells[0]);
			var minY = Math.log(rs.shells[0].getAverageIntensity());
			var maxY = Math.log(rs.shells[rs.shells.length-1].getAverageIntensity());
			for(var i=0;i<rs.shells.length;i++){
				var y = Math.log(rs.shells[i].getAverageIntensity());
				if(maxY < y){ maxY = y; continue; }
				if(minY > y){ minY = y; continue; }
			}

			var canvas = document.getElementById("canvas1");
			var ctx = canvas.getContext("2d");
			ctx.beginPath();
			var chk = false;
			for(var i=0;i<rs.shells.length;i++){
				var x = ((getX(rs.shells[i]) - minX) / (maxX - minX)) * 590 + 5;
				var y = 400 - (((Math.log(rs.shells[i].getAverageIntensity()) - minY) / (maxY - minY)) * 390 + 5);
				if(!chk){ ctx.moveTo(x, y); chk = true; }
				else{ ctx.lineTo(x, y); }
				ctx.fillRect(x - 1, y - 1, 2, 2);
			}
			ctx.stroke();
		};

		var oShells = null, oSca = null;
		document.getElementById("cmdOK").addEventListener("click", function(e) {
			var logLines = null,
				spanStatus = document.getElementById("spanStatus"),
				tblRes = new ResultTableDecorator(document.getElementById("tblResults")),
				tblLog = new LogTableDecorator(document.getElementById("tblLog"));

			var funcProcess = function() {
				// main process
				if(oSca === null){ spanStatus.textContent = "Log file has been read. Reading SCA file ..."; return; }
				if(logLines === null){ spanStatus.textContent = "SCA file has been read. Reading Log file ..."; return; }
				spanStatus.textContent = "Reading SCALEPACK files are finished. Processing ...";
				oShells = ResolutionShells.fromScalepack(logLines, oSca);
				spanStatus.textContent = "Process done.";
				//var tblRes = new ResultTableDecorator(document.getElementById("tblResults"));
				for(var i=oShells.shells.length - 1;i>=0;i--){
					tblRes.addShell(oShells.shells[i]);
					tblLog.addShell(oShells.shells[i].fromLog, oShells.shells[i]);
				}
				tblRes.addTotal(oSca);
				tblLog.addTotal(oShells.totalFromLog, oSca);
				document.getElementById("tdAllObservations").textContent = oShells.allObservations;
				document.getElementById("tdObservationsOver1").textContent = oShells.observationsOver1;
				spanStatus.textContent = "Plotting...";
				drawWilsonPlot();
				spanStatus.textContent = "Ready";
			};

			spanStatus.textContent = "Start reading files ...";
			tblRes.clear();

			var scaFile = document.getElementById("fileSca").files[0];
			var readerSca = new FileReader();
			readerSca.onload = function(e) {
				var lines = e.target.result.trim().split("\n");
				oSca = new ScaFile(lines);
				funcProcess();
			};
			readerSca.readAsText(scaFile);

			var logFile = document.getElementById("fileLog").files[0];
			var readerLog = new FileReader();
			readerLog.onload = function(e) {
				logLines = e.target.result.trim().split("\n");
				funcProcess();
			};
			readerLog.readAsText(logFile);
		}, false);

		document.getElementById("cmdSave").addEventListener("click", function(e) {
			if(!oShells || !oSca){ alert("Calculate, first!!"); return; }
			var lines = ['"Lower","Upper","<I>","<sig(I)>","<I>/<sig(I)>","<I/sig(I)>","Count"'];
			var digits = 2;
			for(var i=oShells.shells.length-1;i>=0;i--){ lines.push(oShells.shells[i].toCSV(digits)); }
			var items = [0,0];
			items.push(oSca.getAverageIntensity().toFixed(digits));
			items.push(oSca.getAverageSigma().toFixed(digits));
			items.push((oSca.getAverageIntensity() / oSca.getAverageSigma()).toFixed(digits));
			items.push(oSca.getAverageIoverSigma().toFixed(digits));
			items.push(oSca.reflections.length);
			lines.push(items.join(","));
			location.href = "data:application/x-download," + encodeURIComponent(lines.join("\n") + "\n");
		}, false);

	}, false);
  </script>
  <style type="text/css">
  	h1 { border-bottom: 1px solid #000099; border-left: .5em solid #000099; margin: 5px 0; padding: 5px; }
  	h2 { margin: 5px 0; padding: 0; }
  	p { color: #666666; font-size: small; margin: 0.5em; }
  	.statistic-table { border-collapse: collapse; }
    .statistic-table td { border: 1px solid #9999ff; }
    .statistic-table tbody tr td, .statistic-table tfoot tr td { width: 4em; text-align: right; padding: 0 .5em; font-family: monospace; }
    .statistic-table tfoot tr td { font-weight: bold; background-color: #ccccff; }
    .statistic-table thead tr td { text-align: center; font-size: small; font-family: Arial, sans-serif; font-weight: bold; background-color: #ccccff; }
  </style>
</head>
<body>
  <h1>Calculating &lt;I/&sigma;(I)&gt; from <i>SCALEPACK</i></h1>
  <p>
    <strong>alpha-release(2011-12-26) by Nobuo OKAZAKI</strong><br/>
    This page requires File API implementation and may work on Firefox 4, Google Chrome 5(not tested), or upper.<br />
    This tool processes files locally and never sends any data to the web!!
  </p>
  <table>
    <tr><td>SCALEPACK .sca file</td><td><input type="file" id="fileSca" size="100" /></td></tr>
    <tr><td>SCALEPACK .log file</td><td><input type="file" id="fileLog" size="100" /></td></tr>
    <tr><td colspan="2"><input type="button" id="cmdOK" value="Calculate &lt;I/&sigma;(I)&gt;" /></td></tr>
  </table>
  <hr />
  <p style="font-weight:bold">Status: <span id="spanStatus" style="color:red">Ready</span></p>
  <h2>Calculated from SCALEPACK.sca</h2>
  <table id="tblResults" class="statistic-table">
    <thead>
      <tr>
        <td colspan="2">Range</td>
        <td rowspan="2">&lt;I&gt;</td><td rowspan="2">&lt;&sigma;(I)&gt;</td>
        <td rowspan="2">&lt;I&gt;/&lt;&sigma;(I)&gt;</td><td rowspan="2">&lt;I/&sigma;(I)&gt;</td>
        <td rowspan="2">Count</td>
      </tr>
      <tr><td>Lower</td><td>Upper</td></tr>
    </thead>
    <tfoot id="tfootResults"></tfoot>
    <tbody id="tbodyResults"></tbody>
  </table>
  <hr />
  <h2>Results from SCALEPACK.log</h2>
  <table class="statistic-table">
    <thead>
      <tr><td colspan="2">Observations</td></tr>
      <tr><td>All</td><td>Over 1</td></tr>
    </thead>
    <tbody>
      <tr><td id="tdAllObservations"></td><td id="tdObservationsOver1"></td></tr>
    </tbody>
  </table>
  <br />
  </table>
  <table id="tblLog" class="statistic-table">
    <thead>
      <tr>
        <td colspan="2">Range</td>
        <td colspan="2">&lt;I&gt;</td><td colspan="2">&lt;&sigma;(I)&gt;</td>
        <td colspan="2">&lt;I&gt;/&lt;&sigma;(I)&gt;</td>
        <td rowspan="2">Redun.</td><td colspan="2">R<sub>merge</sub></td>
        <td rowspan="2">Comp.<br />(%)</td>
        <td rowspan="2">Count</td>
      </tr>
      <tr>
        <td>Lower</td><td>Upper</td>
        <td>Val.</td><td style="color:red">Diff.</td>
        <td>Val.</td><td style="color:red">Diff.</td>
        <td>Val.</td><td style="color:red">Diff.</td>
        <td>Lin.</td><td>Sq.</td>
      </tr>
    </thead>
    <tfoot id="tfootLog"></tfoot>
    <tbody id="tbodyLog"></tbody>
  </table>
  <hr />
  <h2>Save the calculated table</h2>
  <p>Because of the limitation of browser, this can not name the file.</p>
  <input type="button" id="cmdSave" value="Save the table as CSV" />
  <hr />
  <h2>Wilson-plot-like Plot</h2>
<!--  <p><input type="button" id="cmdCalcWilson" value="Calculate Wilson plot" /></p> -->
<!--
  <table id="tblWilson" class="statistic-table">
    <thead>
      <tr>
        <td>Resolution</td><td>(1/(2d))<sup>2</sup></td>
        <td>&lt;I&gt;</td><td>ln(&lt;I&gt; / &Sigma;(f<sup>2</sup>))</td>
      </tr>
    </thead>
    <tfoot></tfoot>
    <tbody></tbody>
  </table>
-->
  <canvas id="canvas1" width="600" height="400" style="border:1px solid blue"></canvas>
</body>
</html>
